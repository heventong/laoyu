this.Clue=this.Clue||{},this.Clue.Phone=function(t,e,n,o){"use strict";o=o&&o.hasOwnProperty("default")?o.default:o;function a(t){var n,o,a,r,i,s,c=this;e.init(this,t),this._state=e.assign({radomSeed:"",btnBgColor:"#f85959",fontColor:"#fff",btnText:"立即拨打"},t.data),this._recompute({},this._state),this._intro=!0,document.getElementById("svelte-anedmy-style")||((n=e.createElement("style")).id="svelte-anedmy-style",n.textContent=".phone-container.svelte-anedmy{width:100%;text-align:center}.btn-phone.svelte-anedmy{width:90%;height:45px;margin:0 auto;border-radius:4px;font-size:18px;line-height:45px;border:none}",e.append(document.head,n)),this._fragment=(o=this._state,{c:function(){a=e.createElement("div"),r=e.createElement("div"),i=e.createElement("button"),s=e.createText(o.btnText),i.className="btn-phone svelte-anedmy",i.id=o.containerId,e.setStyle(i,"background-color",o.btnBgColor),e.setStyle(i,"color",o.fontColor),r.className="phone-container svelte-anedmy"},m:function(t,n){e.insert(t,a,n),e.append(a,r),e.append(r,i),e.append(i,s)},p:function(t,n){t.btnText&&e.setData(s,n.btnText),t.containerId&&(i.id=n.containerId),t.btnBgColor&&e.setStyle(i,"background-color",n.btnBgColor),t.fontColor&&e.setStyle(i,"color",n.fontColor)},d:function(t){t&&e.detachNode(a)}}),this.root._oncreate.push(function(){(function(){}).call(c),c.fire("update",{changed:e.assignTrue({},c._state),current:c._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),e.flush(this))}e.assign(a.prototype,e.proto),e.assign(a.prototype,{}),a.prototype._recompute=function(t,n){this._differs(n.containerId,n.containerId=(e.exclude(n,"containerId"),"phone-"+Math.random().toString(36).substr(2)))&&(t.containerId=!0)};var r,i="https://verify.snssdk.com/static/V2.0/h5_text.js";function s(t,e){var n=document.createElement("script");n.type="text/javascript",n.async=!0,e&&(n.onload=function(){e()},n.onerror=function(t){e(t)}),n.src=t,document.head.appendChild(n)}!function(t){t[t.smartPhoneFirstShow=11]="smartPhoneFirstShow",t[t.smartPhoneLoadFinish=12]="smartPhoneLoadFinish",t[t.smartPhoneSubmit=13]="smartPhoneSubmit"}(r||(r={}));var c=function(){function e(t,e){var o=this;this.container=document.querySelector("body"),this.advToken="",this.clueAccountId=0,this.dotCount=n.logger.dotCount("phone_type"),this.captchaId="",this.captchaFingerPrint="",this.timeStamp={},this.customDeviceId=this.generatorDeviceId(),this.logId=u(10)+"-"+u(16)+"-"+Date.now(),this.baseReqParams={scenario:2,log_id:this.logId},this.controllerMap={normal:"normalPhoneHandler",smart:"smartPhoneHandler"},this.container=e,this.phoneData=t.content,this.advToken=t.advToken,this.clueAccountId=t.clueAccountId,"smart"===this.phoneData.type&&(""==t.content.smartPhoneContent.phoneNumber&&this.getInstance(t.content.smartPhoneContent.instanceId).then(function(t){if(t.data&&!Array.isArray(t.data.phones))throw new Error("instance id do not match any phone");var e=t.data.phones[0];o.phoneData.smartPhoneContent.phoneNumber=e.phone_number}).catch(function(t){}),this.timeStamp[r.smartPhoneLoadFinish]=Date.now(),window.H5_iframe_text||s(i)),this.init(this.phoneData,this.container)}return e.prototype.init=function(t,e){var n=this,o=this.controllerMap[t.type];if(!o)throw new Error(t.type+" is not a valid controller.");e.addEventListener("click",this[o].bind(this),!0);var a=function(){var t=e.getBoundingClientRect().top,o=n.timeStamp[r.smartPhoneFirstShow];t<window.innerHeight&&!o&&(n.timeStamp[r.smartPhoneFirstShow]=Date.now())};a(),window.addEventListener("scroll",a,!1)},e.prototype.generatorDeviceId=function(){var t=window.localStorage.getItem("__tetris_smart_phone__");if(!t){var e=""+Math.random()*Math.pow(10,10);t=""+(parseInt(e).toString()+Date.now()),window.localStorage.setItem("__tetris_smart_phone__",t)}return t},e.prototype.normalPhoneHandler=function(t){t.preventDefault(),t.stopImmediatePropagation();var e=this.phoneData.normalPhoneNumber;window._taq&&window._taq.push({page_url:window.location.href,event_type:"phone",source:"tel",event_value:e,target:this.container,page_type:1}),this.dotCount("normal"),window.location.href="tel:"+e},e.prototype.smartPhoneHandler=function(e){return t.__awaiter(this,void 0,void 0,function(){var o,a,i,s,c,l,h,d;return t.__generator(this,function(u){switch(u.label){case 0:if(e.preventDefault(),e.stopImmediatePropagation(),this.timeStamp[r.smartPhoneSubmit]=Date.now(),o=this.phoneData.smartPhoneContent.phoneNumber,a=this.phoneData.smartPhoneContent.instanceId,i=n.logger.actionLog("smart_phone",""+a),window._taq&&window._taq.push&&window._taq.push({page_url:window.location.href,event_type:"phone",source:"tel",event_value:"smartphone "+a,target:this.container,page_type:1}),i("click_btn",{instanceId:a,originalNumber:o}),!a)return this.dotCount("smart"),window.location.href="tel:"+o,[2];u.label=1;case 1:return u.trys.push([1,6,,7]),(c=window._taq&&"function"==typeof window._taq._get_basedata)?[4,window._taq._get_basedata()]:[3,3];case 2:c=u.sent(),u.label=3;case 3:return s=c,this.baseReqParams=t.__assign({},this.baseReqParams,{convert_data:JSON.stringify(s)||"{}",instance_id:a}),l=t.__assign({},this.baseReqParams,{behaviors:[{at:r.smartPhoneFirstShow.toString(),et:"13",ts:this.timeStamp[r.smartPhoneFirstShow]},{at:r.smartPhoneLoadFinish.toString(),et:"13",ts:this.timeStamp[r.smartPhoneLoadFinish]},{at:r.smartPhoneSubmit.toString(),et:"13",ts:this.timeStamp[r.smartPhoneSubmit]}]}),[4,this.getVirtualNumber(l)];case 4:return h=u.sent(),[4,this.getCallFromResp(h)];case 5:return o=u.sent(),[3,7];case 6:return d=u.sent(),n.logger.error("virtual_number_fail: code error",d),i("virtual_number_fail: code error",JSON.stringify(d)),[3,7];case 7:return this.dotCount("smart"),""!==o&&(window.location.href="tel:"+o),[2]}})})},e.prototype.getCallFromResp=function(e){return t.__awaiter(this,void 0,void 0,function(){var o,a,r,i,s,c,l;return t.__generator(this,function(h){switch(h.label){case 0:return o=this.phoneData.smartPhoneContent.instanceId,a=n.logger.actionLog("smart_phone",""+this.phoneData.smartPhoneContent.instanceId),r="",e&&e.data&&"0"===e.data.status_code?e.data.validate_type?(n.logger.dotCount("phone_valid")(e.data.validate_type),[4,this.selectCaptcha()]):[3,4]:[3,5];case 1:return i=h.sent(),s=i.captchaId,c=i.fingerPrint,[4,this.getVirtualNumber(t.__assign({},this.baseReqParams,{validate:{validate_type:"selection",captcha_id:s,finger_print:c}}))];case 2:return l=h.sent(),[4,this.getCallFromResp(l)];case 3:return[2,h.sent()];case 4:return a("virtual_number_success",{callNumber:r,instanceId:o}),r=e.data.virtual_number,[3,6];case 5:n.logger.error("virtual_number_fail: biz error",e&&e.data),a("virtual_number_fail: biz error",e&&e.data),r="",h.label=6;case 6:return[2,r]}})})},e.prototype.getVirtualNumber=function(e){return t.__awaiter(this,void 0,void 0,function(){var a=this;return t.__generator(this,function(t){switch(t.label){case 0:return[4,o.post("/clue/meta/smart-phone/get-virtual-number?k="+encodeURIComponent(this.advToken)+"&clue_account_id="+this.clueAccountId+"&custom_device_id="+this.customDeviceId,e).catch(function(t){n.logger.error("virtual_number_fail: req error",t),n.logger.actionLog("smart_phone",""+a.phoneData.smartPhoneContent.instanceId)("virtual_number_fail: req error",JSON.stringify(t))})];case 1:return[2,t.sent()]}})})},e.prototype.selectCaptcha=function(){var e=this,o=n.logger.dotCount("phone_valid");return new Promise(function(a,r){if(!window.H5_iframe_text)return n.logger.error("smart_phone: select_not_found",{instanceId:e.phoneData}),void s(i,function(){return t.__awaiter(e,void 0,void 0,function(){var e,n,r;return t.__generator(this,function(t){switch(t.label){case 0:return o("js_callback_select"),[4,this.selectCaptcha()];case 1:return e=t.sent(),n=e.captchaId,r=e.fingerPrint,a({captchaId:n,fingerPrint:r}),[2]}})})});var c=u(32),l=document.createElement("div"),p=document.createElement("div");l.appendChild(p),p.id="captcha-container-"+~~(1e6*Math.random()),h(l),d(p),document.body.appendChild(l);var m=function(){o("select_dialog_closed"),e.selectionVerify&&(e.selectionVerify.hide(),e.selectionVerify=null),l&&(l.style.display="none",l.parentNode.removeChild(l),l=null,p=null)},_={host:"https://verify.snssdk.com",successCb:function(){m();var t=document.cookie.match(/(?:\b|;)s_v_web_id\s*=\s*([^;]+)(?:;|\b)/),e=t&&t.length>1?t[1]:void 0;a({captchaId:c,fingerPrint:e}),o("select_valid_success")},errorCb:function(){m()}},f=t.__assign({},_,{aid:"1483",lang:"zh",app_name:"橙子建站",ele:p.id,external:JSON.stringify({captcha_id:c,log_id:e.logId,type:"1002"}),challenge_code:"1002",toolbarBackColor:"#fff",refreshFontColor:"#4A90E2",refreshIconColor:"#4A90E2",subBackColor:"#4A90E2",subFontColor:"#fff",validatePassBackColor:"#A0CC49",validateFailBackColor:"#EB2F2F"});e.selectionVerify=new window.H5_iframe_text(f),e.selectionVerify.init(),e.selectionVerify.show(),l.style.display="block"})},e.prototype.getInstance=function(e){return t.__awaiter(this,void 0,void 0,function(){return t.__generator(this,function(t){switch(t.label){case 0:return[4,o.post("/clue/meta/smart-phone/get-instance?k="+encodeURIComponent(this.advToken),{instance_id:e})];case 1:return[2,t.sent()]}})})},e.prototype.getAppInfo=function(){return t.__awaiter(this,void 0,void 0,function(){var e;return t.__generator(this,function(t){switch(t.label){case 0:return[4,(n="appInfo",void 0===o&&(o={}),new Promise(function(t,e){var a=setTimeout(function(){clearInterval(r),clearTimeout(a),t({})},3e3),r=setInterval(function(){window.ToutiaoJSBridge&&window.ToutiaoJSBridge.call&&(clearInterval(r),clearTimeout(a),window.ToutiaoJSBridge.call(n,o,function(e){void 0===e&&(e={}),t(e)}))},30)}))];case 1:return e=t.sent(),alert(navigator.userAgent),[2,e]}var n,o})})},e}(),l=function(e){function n(t,n){var o=new a({target:n||document.querySelector("body"),data:t.appearance}).get(),r=document.querySelector("#"+o.containerId);return e.call(this,t,r)||this}return t.__extends(n,e),n}(c),h=function(t){t.style.cssText="\n      display: none;\n      position: fixed;\n      left: 0;\n      top: 0;\n      bottom: 0;\n      right: 0;\n      background: rgba(0, 0, 0, 0.6);\n      z-index: 300;\n    "},d=function(t){t.style.cssText="\n      position: fixed;\n      left: 50%;\n      top: 50%;\n      border-radius: 10px;\n      background: #FFFFFF;\n      box-shadow: 0 5px 13px 0 rgba(0,0,0,0.14);\n      transform: translate(-50%, -50%);\n    "};function u(t){void 0===t&&(t=32);for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",n=e.length,o="",a=0;a<t;a++)o+=e.charAt(~~(Math.random()*n));return o}return function(){function t(){}return t.createPhoneEvent=function(t,e){return new c(t,e)},t.createPhone=function(t,e){return new l(t,e)},t}()}(Clue.Vendor.tslib,Clue.Vendor.svelte_shared,Clue.Vendor.common,Clue.Vendor.flyio);
